1)find top 5 sales products by brand having promotions



select S. product_id,
  P.brand_name,
  sum(store_sales) sum_of_sales
from sales S join products P
  on S.product_id=P.product_id
where promotion_id is not null)T
group by product_id, brand_name
order by sum_of_sales desc
Limit 5



2) what %age of sales happened on first and last day of the promotion


select
promotion_id,
max(num_of_sales) as num_of_sales,
transaction_date,
first_promo_date,
last_promo_date,
cast (100*(sum(case when transaction_date=first_promo_date then 1 else 0 end)/max(num_of_sales)) as decimal(10,2)) as sales_pct_first_promo_day,
cast(100*(sum(case when transaction_date=last_promo_date then 1 else 0 end)/max(num_of_sales)) as decimal(10,2)) as sales_pct_last_promo_day
from
(
select *,
min(transaction_date) over (partition by promotion_id order by promotion_id) first_promo_date,
max(transaction_date) over (partition by promotion_id order by promotion_id) last_promo_date,
1.0*(count(product_id) over (partition by promotion_id order by promotion_id)) num_of_sales
from sales
where promotion_id is not null)T
group by promotion_id,transaction_date,first_promo_date,last_promo_date


--not mine

select
sum(case when transaction_date = (select min(transaction_date) from sales) then 1 else 0)/count(*) as first_day_sales,
sum(case when transaction_date = (select max(transaction_date) from sales) then 1 else 0)/count(*) as last_day_sales
from sales
